(function() {
  var $fs, Flmodule, SourceCollector, pick,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  $fs = require('fs');

  pick = require('file-picker').pick;

  SourceCollector = require('./flutils').SourceCollector;

  Flmodule = (function() {
    function Flmodule(build) {
      this.createBuildCommand = __bind(this.createBuildCommand, this);
      this.addArg = __bind(this.addArg, this);
      this.addSourceDirectory = __bind(this.addSourceDirectory, this);
      this.addExternalLibraryDirectory = __bind(this.addExternalLibraryDirectory, this);
      this.addLibraryDirectory = __bind(this.addLibraryDirectory, this);
      this.collector = new SourceCollector(build);
      this.build = build;
    }

    Flmodule.prototype.addLibraryDirectory = function(path) {
      return this.collector.addLibraryDirectory(path);
    };

    Flmodule.prototype.addExternalLibraryDirectory = function(path) {
      return this.collector.addExternalLibraryDirectory(path);
    };

    Flmodule.prototype.addSourceDirectory = function(path) {
      return this.collector.addSourceDirectory(path);
    };

    Flmodule.prototype.addArg = function(arg) {
      return this.collector.addArg(arg);
    };

    Flmodule.prototype.createBuildCommand = function(report, source, output, complete) {
      var bin;
      bin = 'mxmlc';
      return this.build.getSDKVersion((function(_this) {
        return function(version) {
          var arg, args, directory, library, _i, _j, _k, _l, _len, _len1, _len2, _len3, _ref, _ref1, _ref2, _ref3;
          if (process.platform.indexOf('win') === 0) {
            if (version > '4.6.0') {
              bin = 'mxmlc.bat';
            } else {
              bin = 'mxmlc.exe';
            }
          }
          args = [];
          args.push(_this.build.wrap(_this.build.getEnv('FLEX_HOME') + '/bin/' + bin));
          args.push(_this.build.wrap(_this.build.resolvePath(source)));
          _ref = _this.collector.getLibraries();
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            library = _ref[_i];
            args.push('-library-path ' + _this.build.wrap(library));
          }
          _ref1 = _this.collector.getExternalLibraries();
          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
            library = _ref1[_j];
            args.push('-external-library-path ' + _this.build.wrap(library));
          }
          _ref2 = _this.collector.getSourceDirectories();
          for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
            directory = _ref2[_k];
            args.push('-source-path ' + _this.build.wrap(directory));
          }
          _ref3 = _this.collector.getArgs();
          for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {
            arg = _ref3[_l];
            args.push(_this.build.applyEnv(arg));
          }
          output = _this.build.wrap(_this.build.resolvePath(output));
          report = (report != null) && $fs.existsSync(_this.build.resolvePath(report)) ? _this.build.wrap(_this.build.resolvePath(report)) : null;
          args.push('-size-report ' + output.replace('.swf', '.size.xml'));
          args.push('-output ' + output);
          if (report != null) {
            args.push('-load-externs ' + report);
          }
          if (complete != null) {
            return complete(args.join(' '));
          }
        };
      })(this));
    };

    return Flmodule;

  })();

  module.exports = Flmodule;

}).call(this);

//# sourceMappingURL=data:application/json;base64,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VixDQUFULEVBQUE7V0EzQ29CO1FBQUEsRUFBQTtNQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBckIsRUFObUI7SUFBQSxDQXRCcEIsQ0FBQTs7b0JBQUE7O01BTEQsQ0FBQTs7QUFBQSxFQThFQSxNQUFNLENBQUMsT0FBUCxHQUFpQixRQTlFakIsQ0FBQTtBQUFBIiwiZmlsZSI6ImZsbW9kdWxlLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiJGZzID0gcmVxdWlyZSgnZnMnKVxucGljayA9IHJlcXVpcmUoJ2ZpbGUtcGlja2VyJykucGlja1xue1NvdXJjZUNvbGxlY3Rvcn0gPSByZXF1aXJlKCcuL2ZsdXRpbHMnKVxuXG5jbGFzcyBGbG1vZHVsZVxuXHRjb25zdHJ1Y3RvcjogKGJ1aWxkKSAtPlxuXHRcdEBjb2xsZWN0b3IgPSBuZXcgU291cmNlQ29sbGVjdG9yKGJ1aWxkKVxuXHRcdEBidWlsZCA9IGJ1aWxkXG5cblx0Iz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHQjIGltcGxlbWVudHNcblx0Iz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRhZGRMaWJyYXJ5RGlyZWN0b3J5OiAocGF0aCkgPT5cblx0XHRAY29sbGVjdG9yLmFkZExpYnJhcnlEaXJlY3RvcnkocGF0aClcblxuXHRhZGRFeHRlcm5hbExpYnJhcnlEaXJlY3Rvcnk6IChwYXRoKSA9PlxuXHRcdEBjb2xsZWN0b3IuYWRkRXh0ZXJuYWxMaWJyYXJ5RGlyZWN0b3J5KHBhdGgpXG5cblx0YWRkU291cmNlRGlyZWN0b3J5OiAocGF0aCkgPT5cblx0XHRAY29sbGVjdG9yLmFkZFNvdXJjZURpcmVjdG9yeShwYXRoKVxuXG5cdGFkZEFyZzogKGFyZykgPT5cblx0XHRAY29sbGVjdG9yLmFkZEFyZyhhcmcpXG5cblx0Iz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHQjIHByb2Nlc3Ncblx0Iz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRjcmVhdGVCdWlsZENvbW1hbmQ6IChyZXBvcnQsIHNvdXJjZSwgb3V0cHV0LCBjb21wbGV0ZSkgPT5cblx0XHQjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0IyAwIGdldCBleGVjIGZpbGVcblx0XHQjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0YmluID0gJ214bWxjJ1xuXG5cdFx0QGJ1aWxkLmdldFNES1ZlcnNpb24gKHZlcnNpb24pID0+XG5cdFx0XHRpZiBwcm9jZXNzLnBsYXRmb3JtLmluZGV4T2YoJ3dpbicpIGlzIDBcblx0XHRcdFx0aWYgdmVyc2lvbiA+ICc0LjYuMCdcblx0XHRcdFx0XHRiaW4gPSAnbXhtbGMuYmF0J1xuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0YmluID0gJ214bWxjLmV4ZSdcblxuXHRcdFx0Iy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0XHRcdCMgMSA6IGNyZWF0ZSBwYXRoIGFyZ3Ncblx0XHRcdCMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdFx0XHRhcmdzID0gW11cblxuXHRcdFx0YXJncy5wdXNoKEBidWlsZC53cmFwKEBidWlsZC5nZXRFbnYoJ0ZMRVhfSE9NRScpICsgJy9iaW4vJyArIGJpbikpXG5cblx0XHRcdGFyZ3MucHVzaChAYnVpbGQud3JhcChAYnVpbGQucmVzb2x2ZVBhdGgoc291cmNlKSkpXG5cblx0XHRcdGZvciBsaWJyYXJ5IGluIEBjb2xsZWN0b3IuZ2V0TGlicmFyaWVzKClcblx0XHRcdFx0YXJncy5wdXNoKCctbGlicmFyeS1wYXRoICcgKyBAYnVpbGQud3JhcChsaWJyYXJ5KSlcblxuXHRcdFx0Zm9yIGxpYnJhcnkgaW4gQGNvbGxlY3Rvci5nZXRFeHRlcm5hbExpYnJhcmllcygpXG5cdFx0XHRcdGFyZ3MucHVzaCgnLWV4dGVybmFsLWxpYnJhcnktcGF0aCAnICsgQGJ1aWxkLndyYXAobGlicmFyeSkpXG5cblx0XHRcdGZvciBkaXJlY3RvcnkgaW4gQGNvbGxlY3Rvci5nZXRTb3VyY2VEaXJlY3RvcmllcygpXG5cdFx0XHRcdGFyZ3MucHVzaCgnLXNvdXJjZS1wYXRoICcgKyBAYnVpbGQud3JhcChkaXJlY3RvcnkpKVxuXG5cdFx0XHQjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdFx0IyAyIDogYXJncywgb3V0cHV0XG5cdFx0XHQjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHRcdFx0Zm9yIGFyZyBpbiBAY29sbGVjdG9yLmdldEFyZ3MoKVxuXHRcdFx0XHRhcmdzLnB1c2goQGJ1aWxkLmFwcGx5RW52KGFyZykpXG5cblx0XHRcdG91dHB1dCA9IEBidWlsZC53cmFwKEBidWlsZC5yZXNvbHZlUGF0aChvdXRwdXQpKVxuXHRcdFx0cmVwb3J0ID0gaWYgcmVwb3J0PyBhbmQgJGZzLmV4aXN0c1N5bmMoQGJ1aWxkLnJlc29sdmVQYXRoKHJlcG9ydCkpIHRoZW4gQGJ1aWxkLndyYXAoQGJ1aWxkLnJlc29sdmVQYXRoKHJlcG9ydCkpIGVsc2UgbnVsbFxuXG5cdFx0XHQjIHNpemUtcmVwb3J0XG5cdFx0XHRhcmdzLnB1c2goJy1zaXplLXJlcG9ydCAnICsgb3V0cHV0LnJlcGxhY2UoJy5zd2YnLCAnLnNpemUueG1sJykpXG5cblx0XHRcdCMgc3dmXG5cdFx0XHRhcmdzLnB1c2goJy1vdXRwdXQgJyArIG91dHB1dClcblxuXHRcdFx0IyByZXBvcnRcblx0XHRcdGFyZ3MucHVzaCgnLWxvYWQtZXh0ZXJucyAnICsgcmVwb3J0KSBpZiByZXBvcnQ/XG5cblx0XHRcdGNvbXBsZXRlKGFyZ3Muam9pbignICcpKSBpZiBjb21wbGV0ZT9cblxubW9kdWxlLmV4cG9ydHMgPSBGbG1vZHVsZSJdfQ==